"use strict";var image_url="https://image.tmdb.org/t/p/w500",image_default="img/default.png",api=function(){function e(e){return axios.get(e).then(function(e){return e.data}).catch(function(e){console.log(e),app.$toastr.error(e.message)})}var t="https://api.themoviedb.org/3",r="?api_key=ef963e24f0dc29f7a9347e404b8c5b62";return{movies:{baseUrl:t+"/movie/",popular:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(this.baseUrl+"popular"+r+"&page="+t)},getById:function(t){return e(this.baseUrl+t+r)},related:function(t){return e(this.baseUrl+t+"/similar"+r)}},genres:function(){return e(t+"/genre/movie/list"+r)},favourites:{get:function(){return new Promise(function(e,t){"undefined"!=typeof Storage?e(JSON.parse(localStorage.getItem("favourites")||"[]")):t(new Error("Sorry! No Web Storage support.."))})},set:function(e){return app.$toastr.success("Favourites changed"),localStorage.setItem("favourites",JSON.stringify(e)),e},add:function(e){var t=this;return t.get().then(function(r){return r.push(e),t.set(r)})},remove:function(e){var t=this;return t.get().then(function(r){return r.splice(e,1),t.set(r)})}}}},Details={template:"#details",data:function(){return{item:{},related:[]}},created:function(){var e=this.$route.params.id;this.loadData(e)},watch:{$route:function(e,t){this.loadData(e.params.id)}},computed:{favourites:function(){return shared.favourites}},methods:{loadData:function(e){var t=this;api().movies.getById(e).then(function(e){utils.prepareData(e),t.item=e}),api().movies.related(e).then(function(e){e.results.forEach(function(e){utils.prepareData(e)}),t.related=e.results})}}},Favourites={template:"#favourites",data:function(){return{movies:[]}},created:function(){var e=this;api().favourites.get().then(function(t){t.forEach(function(t){api().movies.getById(t).then(function(t){utils.prepareData(t),e.movies.push(t)})})})},computed:{favourites:function(){return shared.favourites}}};Vue.component("FilmCard",{template:"#film-card",props:{item:Object},data:function(){return{}},created:function(){},computed:{favourites:function(){return shared.favourites},genres:function(){return shared.genresMap}},methods:{setFavourite:function(e){var t,r=this.favourites.indexOf(e.id);t=-1!==r?api().favourites.remove(r):api().favourites.add(e.id),t.then(function(t){shared.favourites=t,e.isFavourite=!e.isFavourite})}}});var Home={template:"#home",data:function(){return{movies:[],search:"",genre:"",isLoading:!0,total:0,page:1,orderBy:shared.orderBy,orderByValue:""}},created:function(){this.getPopularMovies()},computed:{filteredItems:function(){var e=this.search.toLowerCase(),t=this.movies,r=this.genre,a=this.orderByValue;return e&&(t=t.filter(function(t){return-1!==Object.values(t).join().toLowerCase().indexOf(e)})),r&&(t=t.filter(function(e){return-1!==e.genre_ids.indexOf(r)})),a&&(t=_.orderBy(t,a)),t},genres:function(){return shared.genres},favourites:function(){return shared.favourites}},watch:{page:function(e){this.getPopularMovies(e)}},methods:{getPopularMovies:function(e){var t=this;t.isLoading=!0,api().movies.popular(e).then(function(e){e.results.forEach(function(e){utils.prepareData(e)}),t.movies=e.results,t.total=e.total_results,t.isLoading=!1})}}},router=new VueRouter({routes:[{path:"/",component:Home,name:"home"},{path:"/favourites",component:Favourites,name:"favourites"},{path:"/details/:id",component:Details,name:"details"}],scrollBehavior:function(e,t,r){return r||{x:0,y:0}}}),utils={prepareData:function(e){e.backdrop_path?e.image_url=image_url+e.backdrop_path:e.image_url=image_default,e.isFavourite=-1!==shared.favourites.indexOf(e.id),e.rating=Math.ceil(e.vote_average)}},shared={genres:[],favourites:[],genresMap:{},orderBy:[{text:"Title",value:"title"},{text:"Date",value:"release_date"},{text:"Popularity",value:"popularity"},{text:"Rating",value:"vote_average"}]},app=new Vue({el:"#main",router:router,data:{shared:shared},created:function(){var e=this;api().favourites.get().then(function(t){e.shared.favourites=t}),api().genres().then(function(t){e.shared.genres=t.genres,t.genres.forEach(function(t){e.shared.genresMap[t.id]=t.name})})},computed:{favourites:function(){return shared.favourites}}});